var spotifyWindow=document.getElementById("spotifyWindow"),spotifyImagesWindow=document.getElementById("spotifyImagesWindow"),tabList=document.getElementById("tabList"),articles=document.getElementById("articles");function sendSongUrl(e){e.setAttribute("disabled",!0);var t=document.getElementById("songurl").value;if(t.includes("open.spotify.com/"))var a=t.substring(t.indexOf(".com/")+5,t.lastIndexOf("/")),i=t.substring(t.lastIndexOf("/")+1,-1!=t.indexOf("?")?t.indexOf("?"):t.length);else if(t.includes("spotify:"))var a=t.substring(8,t.lastIndexOf(":")),i=t.substring(t.lastIndexOf(":")+1,t.length);if(-1!=["track","album","artist","playlist","user"].indexOf(a)&&22==i.length){let s=new XMLHttpRequest;s.open("POST","/spotify"),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json"),s.onreadystatechange=function(){4===s.readyState&&429===s.status?alert("Too many requests, try again later."):4===s.readyState&&showSpotifyImagesWindow(JSON.parse(s.responseText))},s.send(JSON.stringify({id:i,type:a}))}else alert("Wrong url format.");e.removeAttribute("disabled")}function showSpotifyImagesWindow(e){if("error"in e)alert(e.error.message);else{var t=0,a=e.data[0];for(var a of(tabList.insertAdjacentHTML("beforeend",`<button class="DELETEME" onclick="changeTab(this)" aria-selected="true" aria-controls="${t}">${t}</button>`),articles.insertAdjacentHTML("beforeend",`<article class="DELETEME" role="tabpanel" id="${t}"><img src="${a}" style="max-height: 80vh; max-width: 80vw;"/><p class="pixelatedText">Source: <a href="${a}">${a}</a></p></article>`),t++,e.data))a!=e.data[0]&&(tabList.insertAdjacentHTML("beforeend",`<button class="DELETEME" onclick="changeTab(this)" aria-selected="false" aria-controls="${t}">${t}</button>`),articles.insertAdjacentHTML("beforeend",`<article class="DELETEME" role="tabpanel" hidden id="${t}"><img src="${a}" style="max-height: 80vh; max-width: 80vw;"/><p class="pixelatedText">Source: <a href="${a}">${a}</a></p></article>`),t++);spotifyWindow.setAttribute("hidden",!0),spotifyImagesWindow.removeAttribute("hidden")}}function hideSpotifyImagesWindow(){spotifyImagesWindow.setAttribute("hidden",!0),spotifyWindow.removeAttribute("hidden");let e=document.getElementsByClassName("DELETEME");for(;e.length>0;)e[0].parentNode.removeChild(e[0])}function changeTab(e){var t=e.getAttribute("aria-controls"),a=tabList.getElementsByTagName("button");for(var i of a)i.setAttribute("aria-selected",!1),document.getElementById(i.getAttribute("aria-controls")).setAttribute("hidden",!0);e.setAttribute("aria-selected",!0),document.getElementById(t).removeAttribute("hidden")}