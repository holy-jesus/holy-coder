var spotifyWindow=document.getElementById("spotifyWindow"),spotifyImagesWindow=document.getElementById("spotifyImagesWindow"),spotifyImageWindow=document.getElementById("spotifyImageWindow"),tabList=document.getElementById("tabList"),articles=document.getElementById("articles");function sendSongUrl(e){e.setAttribute("disabled",!0);var t=document.getElementById("songurl").value,i=t.substring(t.indexOf(".com/")+5,t.lastIndexOf("/")),a=t.substring(t.lastIndexOf("/")+1,-1!=t.indexOf("?")?t.indexOf("?"):t.length);if(-1!=["track","album","artist","playlist","user"].indexOf(i)){let s=new XMLHttpRequest;s.open("POST","/spotify"),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json"),s.onreadystatechange=function(){4===s.readyState&&200===s.status?showSpotifyImagesWindow(JSON.parse(s.responseText)):4===s.readyState&&429===s.status?alert("Too many requests, try again later."):4===s.readyState&&alert("Something went wrong. Please try again later")},s.send(JSON.stringify({id:a,type:i}))}else alert("Wrong url format.");e.removeAttribute("disabled")}function showSpotifyImagesWindow(e){if("error"in e)alert(e.error.message);else{var t=0,i=e.data[0],a=t;tabList.insertAdjacentHTML("beforeend",`<button class="DELETEME" onclick="changeTab(this)" aria-selected="true" aria-controls="${a}">${a}</button>`),articles.insertAdjacentHTML("beforeend",`<article class="DELETEME" role="tabpanel" id="${a}"><img id="img${a}" src="${i.url}" style="max-height: 80vh; max-width: 80vw;"/><p id="size${a}" class="pixelatedText">Original size: ${i.width}x${i.height}</p><p class="pixelatedText">Source: <a href="${i.url}">${i.url}</a></p></article>`);var s=document.getElementById(`img${a}`);for(var i of(s.onload=function(){console.log(`Original size: ${this.width}x${this.height}`),document.getElementById(`size${a}`).innerText=`Original size: ${this.width}x${this.height}`},t++,e.data))if(i!=e.data[0]){var a=t;tabList.insertAdjacentHTML("beforeend",`<button class="DELETEME" onclick="changeTab(this)" aria-selected="false" aria-controls="${a}">${a}</button>`),articles.insertAdjacentHTML("beforeend",`<article class="DELETEME" role="tabpanel" hidden id="${a}"><img id="img${a}" src="${i.url}" style="max-height: 80vh; max-width: 80vw;"/><p id="size${a}" class="pixelatedText">Original size: ${i.width}x${i.height}</p><p class="pixelatedText">Source: <a href="${i.url}">${i.url}</a></p></article>`);var s=document.getElementById(`img${a}`);s.onload=function(){console.log(`Original size: ${this.width}x${this.height}`),document.getElementById(`size${a}`).innerText=`Original size: ${this.width}x${this.height}`},t++}spotifyWindow.setAttribute("hidden",!0),spotifyImagesWindow.removeAttribute("hidden")}}function hideSpotifyImagesWindow(){spotifyImagesWindow.setAttribute("hidden",!0),spotifyWindow.removeAttribute("hidden");let e=document.getElementsByClassName("DELETEME");for(;e.length>0;)e[0].parentNode.removeChild(e[0])}function changeTab(e){var t=e.getAttribute("aria-controls"),i=tabList.getElementsByTagName("button");for(var a of i)a.setAttribute("aria-selected",!1),document.getElementById(a.getAttribute("aria-controls")).setAttribute("hidden",!0);e.setAttribute("aria-selected",!0),document.getElementById(t).removeAttribute("hidden")}