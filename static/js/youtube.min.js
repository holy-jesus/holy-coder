var youtubeWindow=document.getElementById("youtubeWindow"),loadingWindow=document.getElementById("loadingWindow"),youtubeVideoWindow=document.getElementById("youtubeVideoWindow");function sleep(e){return new Promise(t=>setTimeout(t,1e3*e))}async function startDownloadingVideo(e){e.setAttribute("disabled",!0);var t=document.getElementById("videoUrl").value,n=document.querySelector('input[name="type"]:checked').value;if(t.includes("youtube.com/watch?v="))var o=t.substring(t.indexOf("v=")+2,t.length);else if(t.includes("youtu.be/"))var o=t.substring(t.indexOf(".be/")+4,t.length);if(11==o.length){let i=new XMLHttpRequest;i.open("POST","/youtube"),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=async function(){if(4===i.readyState&&429===i.status)alert("Too many requests, try again later.");else if(4===i.readyState){var e=JSON.parse(i.responseText);!0==e?await showVideoWindow(o,n):null==e?alert("Sorry I can't download this video"):await showLoadingWindow(o,n)}},i.send(JSON.stringify({id:o,type:parseInt(n,10)}))}else alert("Wrong url format.");e.removeAttribute("disabled")}async function showLoadingWindow(e,t){youtubeWindow.setAttribute("hidden",!0),loadingWindow.removeAttribute("hidden");let n=new XMLHttpRequest;var o=!1;for(n.onreadystatechange=async function(){if(4===n.readyState&&200===n.status){var e=JSON.parse(n.responseText);!0==e?o=!0:null==e&&(alert("Sorry I can't download this video"),o=null)}};await sleep(4),n.open("GET",`/youtube?id=${e}&type=${t}`),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.send(null),await sleep(1),!0!=o&&null!=o;);!0==o?await showVideoWindow(e,t):(loadingWindow.setAttribute("hidden",!0),youtubeWindow.removeAttribute("hidden"))}async function showVideoWindow(e,t){loadingWindow.setAttribute("hidden",!0),youtubeVideoWindow.removeAttribute("hidden"),(a=document.getElementById("aForButton")).setAttribute("href",`/youtube/download?id=${e}&type=${t}`),(element=document.getElementById("urlForDownloading")).innerHTML=`https://holy-coder.ru/youtube/download?id=${e}&type=${t}`,element.setAttribute("href",`/youtube/download?id=${e}&type=${t}`)}function hideVideoWindow(){youtubeVideoWindow.setAttribute("hidden",!0),youtubeWindow.removeAttribute("hidden")}