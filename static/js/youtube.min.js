var youtubeWindow=document.getElementById("youtubeWindow"),loadingWindow=document.getElementById("loadingWindow"),youtubeVideoWindow=document.getElementById("youtubeVideoWindow");function sleep(e){return new Promise(t=>setTimeout(t,1e3*e))}async function startDownloadingVideo(e){e.setAttribute("disabled",!0);var t=document.getElementById("videoUrl").value,n=document.querySelector('input[name="type"]:checked').value;if(t.includes("youtube.com/watch?v="))var o=t.substring(t.indexOf("v=")+2,t.length);else if(t.includes("youtu.be/"))var o=t.substring(t.indexOf(".be/")+4,t.length);else var o="";if(11==o.length){let i=new XMLHttpRequest;i.open("POST","/youtube"),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=async function(){if(4===i.readyState&&429===i.status)alert(MS.too_many_requests);else if(4===i.readyState){var e=JSON.parse(i.responseText);"string"==typeof e||e instanceof String?await showVideoWindow(o,n,e):null==e?alert(MS.cant_download):await showLoadingWindow(o,n)}},i.send(JSON.stringify({id:o,type:parseInt(n,10)}))}else alert(MS.wrong_url);e.removeAttribute("disabled")}async function showLoadingWindow(e,t){youtubeWindow.setAttribute("hidden","true"),loadingWindow.removeAttribute("hidden");let n=new XMLHttpRequest;var o=!1;for(n.onreadystatechange=async function(){if(4===n.readyState&&200===n.status){var e=JSON.parse(n.responseText);"string"==typeof e||e instanceof String?(o=!0,filename=e):null==e&&(alert(MS.cant_download),o=null)}else 4===n.readyState&&(alert(MS.error),o=null)};await sleep(4),n.open("GET",`/youtube?id=${e}&type=${t}`),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),n.send(null),await sleep(1),!1==o;);!0==o?await showVideoWindow(e,t,filename):(loadingWindow.setAttribute("hidden","true"),youtubeWindow.removeAttribute("hidden"))}async function showVideoWindow(e,t,n){youtubeWindow.setAttribute("hidden","true"),loadingWindow.setAttribute("hidden","true"),youtubeVideoWindow.removeAttribute("hidden"),(a=document.getElementById("aForButton")).setAttribute("href",`/youtube/${n}?id=${e}&type=${t}`);var o=document.getElementById("urlForDownloading");o.innerText=`https://holy-coder.ru/youtube/${n}?id=${e}&type=${t}`,o.setAttribute("href",`/youtube/${n}?id=${e}&type=${t}`)}function hideVideoWindow(){youtubeVideoWindow.setAttribute("hidden","true"),youtubeWindow.removeAttribute("hidden")}